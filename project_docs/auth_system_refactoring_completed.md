# 로그인 시스템 리팩토링 작업 내역

## 개요

본 문서는 온라인 팝스(PAPS) 교육 플랫폼의 로그인 시스템 리팩토링 작업 내역을 기록한 것입니다. 기존의 코드에서 Custom Token 관련 코드를 완전히 제거하고, 중복/불필요한 코드를 정리하여 안정성과 유지보수성을 개선했습니다.

## 주요 변경 사항

### 1. 중복 유스케이스 제거

- `LoginWithEmailPassword` 유스케이스 파일을 제거하고, 동일한 기능을 하는 `SignInWithEmailPassword`로 통합했습니다.
- 의존성 주입 설정에서 관련 코드를 업데이트했습니다.

### 2. Firebase Functions에서 Custom Token 관련 코드 정리

- `studentLogin` 함수 관련 코드 중 더 이상 사용하지 않는 부분을 제거했습니다.
- `getStudentLoginEmail` 함수에 대한 의존성만 유지합니다.

### 3. `AuthCubit`의 `signOut` 메서드 개선

- 로그아웃 과정의 안정성을 높이기 위해 로직을 전면 수정했습니다.
- 이미 로그아웃 상태인 경우 불필요한 작업을 건너뛰도록 최적화했습니다.
- Firebase Auth에서 먼저 로그아웃 후에 UI 상태를 변경하도록 순서를 변경했습니다.
- 로그아웃 실패 시 적절한 상태 복원 로직을 추가했습니다.

### 4. 오류 처리 통합 및 최적화

- `CloudFunctionsService` 클래스에 공통 오류 처리 헬퍼 메서드 `_getFirebaseFunctionErrorMessage`를 추가했습니다.
- 중복되는 오류 처리 로직을 통합하여 코드의 일관성과 유지보수성을 높였습니다.
- 오류 메시지에 컨텍스트를 추가할 수 있도록 개선했습니다.

### 5. 로그인 페이지 UX 개선

- 에러 메시지 표시 방식을 개선했습니다(Floating SnackBar, 닫기 버튼 추가, 더 긴 노출 시간).
- 기존 스낵바를 제거하고 새로운 메시지를 표시하도록 하여 메시지 중복 표시 문제를 해결했습니다.

## 안정성 개선 방안

1. **상태 관리 강화**:
   - 상태 변경 전에 필요한 조건 검사를 추가했습니다.
   - 예외 발생 시에도 일관된 상태를 유지하도록 예외 처리를 개선했습니다.

2. **비동기 작업 순서 최적화**:
   - Firebase 작업(인증, 데이터 저장 등)을 UI 상태 변경 전에 처리하여 작업 실패 시 UI가 일관된 상태를 유지하도록 했습니다.

3. **오류 처리 표준화**:
   - 오류 메시지 생성 로직을 중앙화하여 일관된 오류 메시지를 제공합니다.
   - Firebase 오류 코드에 따라 사용자 친화적인 메시지를 제공합니다.

4. **불필요한 코드 제거**:
   - 미사용되거나 중복된 코드를 제거하여 코드 베이스를 간소화했습니다.
   - Legacy 코드를 안전하게 제거하고 새로운 코드로 대체했습니다.

## 향후 개선 사항

1. **성능 최적화**:
   - 불필요한 인증 상태 체크 및 데이터 로드를 더욱 최소화할 수 있습니다.
   - 상태 변경 이벤트를 디바운싱/쓰로틀링하여 과도한 UI 업데이트를 방지할 수 있습니다.

2. **테스트 강화**:
   - 인증 관련 단위 테스트 및 통합 테스트를 추가하여 리팩토링된 코드의 안정성을 검증할 수 있습니다.

3. **코드 구조 개선**:
   - 인증 관련 로직을 더 작은 단위로 분리하여 책임을 명확히 할 수 있습니다.
   - 코드 재사용성을 높이기 위한 추가적인 리팩토링을 진행할 수 있습니다.

이 리팩토링을 통해 로그인 시스템의 안정성과 유지보수성이 크게 향상되었으며, 향후 플랫폼 확장에도 더 견고한 기반을 제공할 것입니다.
